# ğŸ¯ FID-20251017-026: UI Enhancements & Forest System

**Date:** 2025-10-17  
**Status:** ğŸ“‹ PLANNED  
**Complexity:** 3/5  
**Estimate:** 2-3 hours

---

## ğŸ“‹ **REQUIREMENTS**

### **1. Unit Building System** âœ… ALREADY DONE
- [x] Allow unit building anywhere (not just at factories)
- [x] Still costs resources
- [x] No build limits or cooldowns

**Status:** This is already implemented in game/page.tsx (lines 163-186)

### **2. Factory Count Display** ğŸ”´ TODO
**Where:** StatsPanel.tsx - Military Power section
**Implementation:**
- Add factory count below Total Units
- Fetch from player data or calculate from factories collection
- Format: `ğŸ­ Factories: X`

### **3. Forest Terrain System** ğŸ”´ TODO
**New Terrain Type:** `Forest` (450 tiles, 2%)
- Operates like Caves (exploration-based)
- Better loot rates and rewards
- Uses F key (same as caves)

**Implementation Steps:**
- [x] Add `Forest` to `TerrainType` enum
- [x] Update `TERRAIN_COUNTS` (Cave: 1800, Forest: 450, Wasteland: 8500)
- [ ] Create `generateForestItem()` function with better drop rates
- [ ] Add Forest handling to harvest API
- [ ] Add Forest button/UI similar to cave button
- [ ] Update TileRenderer to show Forest tiles
- [ ] Create Forest tile visual/icon

**Forest Loot System:**
- Drop Rate: 50% (vs Cave 30%)
- Digger Rate: 30% (vs Cave 20%)  
- Tradeable Rate: 70% (vs Cave 80%)
- Higher quality diggers (better rarity distribution)

### **4. Map Regeneration** ğŸ”´ TODO
**Special Locations:**
- (1,1) = Shrine âœ… (already correct)
- (25,25) = Metal Bank ğŸ”´ (currently empty)
- (50,50) = Exchange Bank ğŸ”´ (currently empty)
- (75,75) = Energy Bank ğŸ”´ (currently empty)
- (100,100) = Exchange Bank ğŸ”´ (currently empty)

**Action Required:**
```bash
npm run init-map  # Will regenerate with correct special locations
```

**Note:** Map generation code is already correct in `mapGeneration.ts` - just needs re-run

### **5. Sidebar Inventory Enhancements** ğŸ”´ TODO
**Current State:** Basic inventory panel exists
**Needed:** Match sample game UI with more stats

**Required Stats:**
- Current items (grouped by type)
- Metal/Energy digger counts
- Tradeable item count
- Caves explored count
- Forests explored count (new)
- Total gathering bonus display

---

## ğŸ› ï¸ **IMPLEMENTATION PLAN**

### **Phase A: Forest System (1 hour)**
1. âœ… Update terrain types and constants
2. Create `generateForestItem()` in `caveItemService.ts`
3. Add Forest exploration logic to `harvestService.ts`
4. Update harvest API to handle Forest terrain
5. Add Forest button component
6. Update TileRenderer for Forest visuals

### **Phase B: UI Enhancements (0.5 hours)**
1. Add factory count to StatsPanel
2. Enhance InventoryPanel with detailed stats
3. Update controls panel instructions

### **Phase C: Map Regeneration (0.5 hours)**
1. Backup current player data
2. Run map regeneration script
3. Verify special locations exist
4. Test game functionality

---

## ğŸ“Š **FOREST VS CAVE COMPARISON**

| Feature | Cave | Forest |
|---------|------|--------|
| Quantity | 1,800 tiles (8%) | 450 tiles (2%) |
| Drop Rate | 30% | 50% |
| Digger Rate | 20% of drops | 30% of drops |
| Tradeable Rate | 80% of drops | 70% of drops |
| Rarity Distribution | Standard | Enhanced |
| Accessibility | Common | Rare reward |

---

## ğŸ¯ **ACCEPTANCE CRITERIA**

- [ ] Factory count displayed in StatsPanel
- [ ] Forest terrain type exists in game
- [ ] Forest tiles explorable with F key
- [ ] Forest loot system provides better rewards than caves
- [ ] Special locations (25,25), (50,50), (75,75), (100,100) are Banks
- [ ] Inventory sidebar shows detailed statistics
- [ ] All features work without errors

---

## âš ï¸ **RISKS & CONSIDERATIONS**

1. **Map Regeneration:** Will clear all tiles, factories become neutral
2. **Player Progress:** Units and resources are safe, but factory ownership resets
3. **Forest Rarity:** Only 450 tiles makes them valuable/rare (intentional design)
4. **Balance:** Forest loot rates may need tuning based on testing

---

## ğŸ“ **NOTES**

- Unit building anywhere is already working âœ…
- Forest is intentionally rare (2% vs Cave 8%)
- Better rewards justified by rarity
- Map code is correct, just needs regeneration
- No game mechanics changes requested
